# Home Assistant Add-on: DuckDNS

## Installation

Follow these steps to get the add-on installed on your system:

1. Navigate in your Home Assistant frontend to **Settings** -> **Add-ons** -> **Add-on store**.
2. Find the "DuckDNS" add-on and click it.
3. Click on the "INSTALL" button.

## How to use

1. Visit [DuckDNS.org](https://www.duckdns.org/) and create an account by logging in through any of the available account services (Google, Github, Twitter, Persona, Reddit).
2. In the `Domains` section, type the name of the subdomain you wish to register and click `add domain`.
3. If registration was a success, the subdomain is listed in the `Domains` section along with `current ip` being the public IP address of the device you are currently using to access `duckdns.org`. The IP address will be updated by the DuckDNS add-on.
4. In the DuckDNS add-on configuration, perform the following:
   - Copy the DuckDNS token (listed at the top of the page where account details are displayed) from `duckdns.org` and paste into the `token` option.
   - Update the `domains` option with the full domain name you registered. E.g., `my-domain.duckdns.org`.

## Configuration

Add-on configuration:

```yaml
domains:
  - my-domain.duckdns.org
token: sdfj-2131023-dslfjsd-12321
lets_encrypt:
  accept_terms: true
  certfile: fullchain.pem
  keyfile: privkey.pem
seconds: 300
```

Additionally, you'll need to configure the Home Assistant Core to pick up the SSL certificates. This is done by setting the following configuration for the [HTTP][HTTP] integration configuration in your `configuration.yaml`:

```yaml
http:
  ssl_certificate: /ssl/fullchain.pem
  ssl_key: /ssl/privkey.pem
```

### Option: `domains`

A list of DuckDNS subdomains registered under your account. An acceptable naming convention is `my-domain.duckdns.org`.

### Option: `token`

The DuckDNS authentication token found at the top of the DuckDNS account landing page. The token is required to make any changes to the subdomains registered to your account.

### Option group `lets_encrypt`

The following options are for the option group: `lets_encrypt`. These settings only apply to Let's Encrypt SSL certificates.

#### Option `lets_encrypt.accept_terms` (optional)

Once you have read and accepted the Let's Encrypt [Subscriber Agreement](https://letsencrypt.org/repository/), and you would like this addon to obtain and renew certificates for your Duck DNS subdomains, change value to `true` in order to use Let's Encrypt services.

#### Option `lets_encrypt.certfile`

The name of the certificate file generated by Let's Encrypt. The file is used for SSL by Home Assistant add-ons and is recommended to keep the filename as-is (`fullchain.pem`) for compatibility.

**Note**: _The file is stored in `/ssl/`, which is the default for Home Assistant_

#### Option `lets_encrypt.keyfile`

The name of the private key file generated by Let's Encrypt. The private key file is used for SSL by Home Assistant add-ons and is recommended to keep the filename as-is (`privkey.pem`) for compatibility.

**Note**: _The file is stored in `/ssl/`, which is the default for Home Assistant_

#### Option `lets_encrypt.algo`

Public key algorithm that will be used.

Supported values: `rsa`, `prime256v1` and `secp384r1`.

The default is `secp384r1`

### Option: `seconds`

The number of seconds to wait before updating DuckDNS subdomains and renewing Let's Encrypt certificates.

### Option: `ipv4` (optional)

By default, Duck DNS will auto detect your IPv4 address and use that.
This option allows you to override the auto-detection and specify an
IPv4 address manually.

If you specify a URL here, contents of the resource it points to will be
fetched and used as the address. This enables getting the address using
a service like https://api.ipify.org/ or https://ipv4.text.wtfismyip.com

### Option: `ipv6` (optional)

By default, Duck DNS will auto detect your IPv6 address and use that.
This option allows you to override the auto-detection and specify an
IPv6 address manually.

If you specify a URL here, contents of the resource it points to will be
fetched and used as the address. This enables getting the address using
a service like https://api6.ipify.org/ or https://ipv6.text.wtfismyip.com

## Known issues and limitations

- To log in, DuckDNS requires a free account from any of the following services: Google, Github, Twitter or Persona.
- A free DuckDNS account is limited to five subdomains.
- At time of writing, Duck DNS' own IPv6 autodetection
  [does not actually work][duckdns-faq], but you can use the URL option
  for `ipv6` to get around this, read on.
- This addon no longer offers the option of obtaining Let's Encrypt certificates for DNS aliases as it proved problematic due to limitations with DuckDNS.
  You can obtain certificates for custom domains using the [Let's Encrypt addon][lets-encrypt-addon] as detailed below.

## Using DuckDNS and Let's Encrypt addons to get certificates for your own domains

Support for obtaining Let's Encrypt certificates for DNS aliases was removed in version 2.0.0 of this addon.
You can get this functionality by using the [Let's Encrypt addon][lets-encrypt-addon] as follows:

1. Install the DuckDNS addon and configure it as detailed above.
2. Create a CNAME record with your DNS provider to point each of your custom domains at the DuckDNS subdomains. For example:

```
CNAME                 <own-domain>                    <domain>.duckdns.org
CNAME                 <another-own-domain>            <another-domain>.duckdns.org
```

Refer to your DNS provider documentation for details on how to do this.
3. Install the Let's Encrypt addon and configure it to suit your needs using the domains you created CNAME records for.
  - If your DNS provider is supported by the Let's Encrypt addon, select the `dns` challenge and enter the appropriate DNS provider configuration.
  - If your DNS provider is not supported by the Let's Encrypt addon, select the `http` challenge and ensure port 80 on your Home Assistant machine is accessible from the internet.

4. Save the Let's Encrypt settings and start the plugin. This will generate a certificate for your own domains and then stop the extension.

The Let's Encrypt addon does not automatically renew certificates when they expire so you will need to remember to do this manually or use an automation, for example this [blueprint][renew-blueprint].

## Support

Got questions?

You have several options to get them answered:

- The [Home Assistant Discord Chat Server][discord].
- The Home Assistant [Community Forum][forum].
- Join the [Reddit subreddit][reddit] in [/r/homeassistant][reddit]

In case you've found a bug, please [open an issue on our GitHub][issue].

[discord]: https://discord.gg/c5DvZ4e
[forum]: https://community.home-assistant.io
[issue]: https://github.com/home-assistant/addons/issues
[reddit]: https://reddit.com/r/homeassistant
[duckdns-faq]: https://www.duckdns.org/faqs.jsp
[HTTP]: https://www.home-assistant.io/integrations/http/
[lets-encrypt-addon]: https://github.com/home-assistant/addons/tree/master/letsencrypt
[renew-blueprint]: https://community.home-assistant.io/t/blueprint-for-automatic-renewal-of-a-lets-encrypt-certificate/300533
